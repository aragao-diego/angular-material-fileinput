!function(e,i,n){"use strict";var l=function(){return"lfobjxxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0,n="x"==e?i:3&i|8;return n.toString(16)})},t=i.module("lfNgMdFileInput",["ngMaterial"]);t.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),t.directive("lfRequired",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,l){l&&(l.$validators.required=function(e,i){return!!e&&e.length>0})}}}),t.directive("lfMaxcount",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,l){if(l){var t=-1;n.$observe("lfMaxcount",function(e){var i=parseInt(e,10);t=isNaN(i)?-1:i,l.$validate()}),l.$validators.maxcount=function(e,i){return!!e&&e.length<=t}}}}}),t.directive("lfFilesize",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,l){if(l){var t=-1;n.$observe("lfFilesize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var n=["Byte","KB","MB"],r=e.match(i)[1],a=e.substring(0,e.indexOf(r));n.every(function(e,i){return r!==e||(t=parseInt(a)*Math.pow(1024,i),!1)})}else t=-1;l.$validate()}),l.$validators.filesize=function(e,i){if(!e)return!1;var n=!0;return e.every(function(e,i){return!(e.lfFile.size>t)||(n=!1,!1)}),n}}}}}),t.directive("lfTotalsize",function(){return{restrict:"A",require:"ngModel",link:function(e,n,l,t){if(t){var r=-1;l.$observe("lfTotalsize",function(e){var i=/^[1-9][0-9]*(Byte|KB|MB)$/;if(i.test(e)){var n=["Byte","KB","MB"],l=e.match(i)[1],a=e.substring(0,e.indexOf(l));n.every(function(e,i){return l!==e||(r=parseInt(a)*Math.pow(1024,i),!1)})}else r=-1;t.$validate()}),t.$validators.totalsize=function(e,n){if(!e)return!1;var l=0;return i.forEach(e,function(e,i){l+=e.lfFile.size}),l<r}}}}}),t.directive("lfMimetype",function(){return{restrict:"A",require:"ngModel",link:function(e,i,n,l){if(l){var t;n.$observe("lfMimetype",function(e){t=new RegExp(e,"i"),l.$validate()}),l.$validators.mimetype=function(e,i){if(!e)return!1;var n=!0;return e.every(function(e,i){return!!e.lfFile.type.match(t)||(n=!1,!1)}),n}}}}}),t.directive("lfNgMdFileInput",["$q","$compile","$timeout",function(t,r,a){return{restrict:"E",template:['<div layout="column" class="lf-ng-md-file-input" ng-model="'+l()+'">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<md-button aria-label="remove all files" class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull || !isPreview || !minimalist" >&times;</md-button>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="(isFilesNull || !isPreview) && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails" ng-show="isPreview">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">',"{{strCaption}}","</div>",'<md-progress-linear md-mode="determinate" value="{{floatProgress}}" ng-show="intLoading && isProgress"></md-progress-linear>',"</div>",'<md-button aria-label="remove all files" ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="isFilesNull || intLoading" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" ng-click="openDialog($event, this)" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" >','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" aria-label="{{strAriaLabel}}" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" />',"</md-button>","</div>","</div>"].join(""),replace:!0,require:"ngModel",scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfCaption:"@?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",lfOnFileClick:"=?",accept:"@?",ngDisabled:"=?"},link:function(o,s,f,c){var d=i.element(s[0].querySelector(".lf-ng-md-file-input-tag")),u=i.element(s[0].querySelector(".lf-ng-md-file-input-drag")),m=i.element(s[0].querySelector(".lf-ng-md-file-input-thumbnails")),p=!1,g=0;o.intLoading=0,o.floatProgress=0,o.isPreview=!1,o.isDrag=!1,o.isMutiple=!1,o.isProgress=!1,i.isDefined(f.preview)&&(o.isPreview=!0),i.isDefined(f.drag)&&(o.isDrag=!0),i.isDefined(f.multiple)?(d.attr("multiple","multiple"),o.isMutiple=!0):d.removeAttr("multiple"),i.isDefined(f.progress)&&(o.isProgress=!0),o.minimalist=!i.isDefined(f.minimalist),o.isDisabled=!1,i.isDefined(f.ngDisabled)&&o.$watch("ngDisabled",function(e){o.isDisabled=e}),o.strBrowseIconCls="lf-browse",o.strRemoveIconCls="lf-remove",o.strCaptionIconCls="lf-caption",o.strUnknowIconCls="lf-unknow",i.isDefined(f.lfOption)&&i.isObject(o.lfOption)&&(o.lfOption.hasOwnProperty("browseIconCls")&&(o.strBrowseIconCls=o.lfOption.browseIconCls),o.lfOption.hasOwnProperty("removeIconCls")&&(o.strRemoveIconCls=o.lfOption.removeIconCls),o.lfOption.hasOwnProperty("captionIconCls")&&(o.strCaptionIconCls=o.lfOption.captionIconCls),o.lfOption.hasOwnProperty("unknowIconCls")&&(o.strUnknowIconCls=o.lfOption.unknowIconCls)),o.accept=o.accept||"",o.lfFiles=[],o[f.ngModel]=o.lfFiles,o.$watch("lfFiles.length",function(e,i){c.$validate()}),o.lfApi=new function(){var e=this;e.removeAll=function(){o.removeAllFiles()},e.removeByName=function(e){o.removeFileByName(e)},e.addBase64Image=function(e){function i(e,i,n){i=i||"",n=n||512;for(var l=atob(e),t=[],r=0;r<l.length;r+=n){for(var a=l.slice(r,r+n),o=new Array(a.length),s=0;s<a.length;s++)o[s]=a.charCodeAt(s);var f=new Uint8Array(o);t.push(f)}var c=new Blob(t,{type:i});return c}var n="image/png",l=e,t=i(l,n);URL.createObjectURL(t);setTimeout(v(t),100)}},o.isFilesNull=!0,o.strCaption="",o.strCaptionPlaceholder="Select file",o.strCaptionDragAndDrop="Drag & drop files here...",o.strCaptionBrowse="Browse",o.strCaptionRemove="Remove",o.strAriaLabel="",i.isDefined(f.ariaLabel)&&(o.strAriaLabel=f.ariaLabel),i.isDefined(f.lfPlaceholder)&&o.$watch("lfPlaceholder",function(e){o.strCaptionPlaceholder=e}),i.isDefined(f.lfCaption)&&(p=!0,o.$watch("lfCaption",function(e){o.strCaption=e})),o.lfDragAndDropLabel&&(o.strCaptionDragAndDrop=o.lfDragAndDropLabel),o.lfBrowseLabel&&(o.strCaptionBrowse=o.lfBrowseLabel),o.lfRemoveLabel&&(o.strCaptionRemove=o.lfRemoveLabel),u.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!o.isDisabled&&o.isDrag&&u.addClass("lf-ng-md-file-input-drag-hover")}),u.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!o.isDisabled&&o.isDrag&&u.removeClass("lf-ng-md-file-input-drag-hover")}),u.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!o.isDisabled&&o.isDrag){u.removeClass("lf-ng-md-file-input-drag-hover"),i.isObject(e.originalEvent)&&(e=e.originalEvent);var n=e.target.files||e.dataTransfer.files,l=0;if(!(n.length<=0)){var t=o.lfFiles.map(function(e){return e.lfFileName}),r=new RegExp(o.accept,"i");if(o.floatProgress=0,o.isMutiple){g=n.length;for(var l=0;l<n.length;l++){var a=n[l];a.type.match(r)&&(t.indexOf(a.name)!=-1&&o.removeFileByName(a.name),setTimeout(v(a),100*l))}}else{g=1;for(var l=0;l<n.length;l++){var a=n[l];if(a.type.match(r)){o.removeAllFiles(),setTimeout(v(a),100);break}}}}}}),o.openDialog=function(e,i){e&&a(function(){e.preventDefault(),e.stopPropagation();var i=e.target.children[2];i!==n&&i.click()},0)},o.removeAllFiles=function(e){o.isDisabled||(o.lfFiles.length=0,m.empty(),b())},o.removeFileByName=function(e,i){o.isDisabled||(o.lfFiles.every(function(i,n){return i.lfFileName!=e||(i.element.remove(),o.lfFiles.splice(n,1),!1)}),b())},o.onFileChanged=function(e){var i=e.files||e.target.files,n=o.lfFiles.map(function(e){return e.lfFileName});if(!(i.length<=0)){if(o.floatProgress=0,o.isMutiple){g=i.length;for(var l=0;l<i.length;l++){var t=i[l];n.indexOf(t.name)!=-1&&o.removeFileByName(t.name),setTimeout(v(t),100*l)}}else{g=1;for(var l=0;l<i.length;l++){var t=i[l];o.removeAllFiles(),setTimeout(v(t),100);break}}d.val("")}},d.bind("change",o.onFileChanged),o.onFileClick=function(e){i.isFunction(o.lfOnFileClick)&&o.lfFiles.every(function(i,n){return i.key!=e||(o.lfOnFileClick(i,n),!1)})};var v=function(n){o.intLoading++,C(n).then(function(t){var a=n,s=n.name,f=n.type,c=h(n),d=e.URL.createObjectURL(n),u={key:l(),lfFile:a,lfFileName:s,lfDataUrl:d};o.lfFiles.push(u);var p=i.element('<div class="lf-ng-md-file-input-frame" ng-click="onFileClick(\''+u.key+"')\"></div>"),g=i.element('<div aria-label="remove '+n.name+'" class="lf-ng-md-file-input-x" ng-click="removeFileByName(\''+n.name+"',$event)\">&times;<div>"),v="";v="image"==c?'<img src="'+d+'" >':"video"==c?["<video controls>",'<source src="'+d+'" type="'+f+'">',"</video>"].join(""):"audio"==c?["<audio controls>",'<source src="'+d+'" type="'+f+'">',"</audio>"].join(""):['<object data="'+d+'" type="'+f+'"><param name="movie" value="'+a.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<md-icon class="lf-ng-md-file-input-preview-icon" ng-class="strUnknowIconCls"></md-icon>',"</div>","</object>"].join("");var w=i.element(v),F=i.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+a.name+"</div></div>");o.minimalist&&p.append(g),p.append(w),o.minimalist&&p.append(F),r(p)(o),m.append(p),u.element=p,b()},function(e){},function(e){})},b=function(){1==o.lfFiles.length?(p||(o.strCaption=""+o.lfFiles[0].lfFileName),o.isFilesNull=!1):o.lfFiles.length>1?(p||(o.strCaption=""+o.lfFiles.length+" files selected"),o.isFilesNull=!1):(p||(o.strCaption=""),o.isFilesNull=!0)},h=function(e){var i=e.type,n=e.name;return w(i,n)?"image":F(i,n)?"video":y(i,n)?"audio":"object"},w=function(e,i){return!(!e.match("image.*")&&!i.match(/\.(gif|png|jpe?g)$/i))},F=function(e,i){return!(!e.match("video.*")&&!i.match(/\.(og?|mp4|webm|3gp)$/i))},y=function(e,i){return!(!e.match("audio.*")&&!i.match(/\.(ogg|mp3|wav)$/i))},C=function(e,i){var n=t.defer(),l=new FileReader;return l.onloadstart=function(){n.notify(0)},l.onload=function(e){},l.onloadend=function(e){n.resolve({index:i,result:l.result}),o.intLoading--,o.floatProgress=(g-o.intLoading)/g*100},l.onerror=function(e){n.reject(l.result),o.intLoading--,o.floatProgress=(g-o.intLoading)/g*100},l.onprogress=function(e){n.notify(e.loaded/e.total)},l.readAsArrayBuffer(e),n.promise}}}}])}(window,window.angular);